<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pepsval ‚Äî Where Shipping Trust Exists.</title>
  <meta name="description" content="Pepsval is a seafarers‚Äô e-Passport that brings verified identity, sea time, and reputation into one trusted profile." />

  <!-- Bookmark / icon -->
  <link rel="icon" type="image/png" href="logo.png" />
  <link rel="apple-touch-icon" href="logo.png" />
  <meta name="theme-color" content="#0b1220" />

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --radius-xl: 26px;
      --radius-lg: 20px;
      --radius-md: 14px;

      --shadow: 0 22px 70px rgba(0,0,0,.20);
      --shadow2: 0 16px 45px rgba(0,0,0,.14);

      --grad1: linear-gradient(135deg, #8b5cf6, #3b82f6);
      --grad2: radial-gradient(700px 380px at 20% 0%, rgba(139,92,246,.25), transparent 60%),
               radial-gradient(700px 380px at 80% 0%, rgba(59,130,246,.20), transparent 60%);
    }

    /* Light theme */
    :root[data-theme="light"]{
      --bg: #f7f8ff;
      --bg2:#ffffff;
      --text:#0b1020;
      --muted: rgba(11,16,32,.72);
      --muted2: rgba(11,16,32,.55);
      --card: rgba(255,255,255,.78);
      --border: rgba(11,16,32,.10);
      --chip: rgba(11,16,32,.06);
      --link: #0ea5e9;
      --btnText:#07101b;
      --btnGhostBg: rgba(11,16,32,.06);
      --btnGhostBorder: rgba(11,16,32,.12);
      --inputBg: rgba(0,0,0,.04);
      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
    }

    /* Dark theme */
    :root[data-theme="dark"]{
      --bg: #070b17;
      --bg2:#0b1220;
      --text:#eaf0ff;
      --muted: rgba(234,240,255,.78);
      --muted2: rgba(234,240,255,.58);
      --card: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.12);
      --chip: rgba(255,255,255,.06);
      --link: #8be9ff;
      --btnText:#06101b;
      --btnGhostBg: rgba(255,255,255,.06);
      --btnGhostBorder: rgba(255,255,255,.14);
      --inputBg: rgba(255,255,255,.06);
      --ok:#22c55e;
      --warn:#f59e0b;
      --bad:#fb7185;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color: var(--text);
      background:
        radial-gradient(1100px 650px at 15% -5%, rgba(139,92,246,.28), transparent 55%),
        radial-gradient(900px 580px at 92% 10%, rgba(59,130,246,.22), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    a{color:var(--link);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1120px;margin:0 auto;padding:26px 18px 64px}

    /* Top bar */
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:14px;
      padding:12px 14px;
      border:1px solid var(--border);
      border-radius: var(--radius-lg);
      background: var(--card);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow2);
      position:sticky;top:12px;z-index:20;
    }

    /* Brand (big + blended, not inside a box) */
    .brand{display:flex;align-items:center;gap:14px}
    .logoWrap{
      position:relative;
      width:58px;height:58px;
      display:grid;place-items:center;
      transform-origin:center;
      animation: popIn 900ms cubic-bezier(.16,1,.3,1) 120ms both;
    }
    .logoWrap::before{
      content:"";
      position:absolute;inset:-16px;
      background: radial-gradient(circle at 30% 30%, rgba(139,92,246,.36), transparent 60%),
                  radial-gradient(circle at 70% 70%, rgba(59,130,246,.30), transparent 62%);
      filter: blur(10px);
      opacity:.95;
      animation: floatGlow 5.4s ease-in-out infinite;
      pointer-events:none;
    }
    .logoWrap::after{
      content:"";
      position:absolute;inset:-6px;
      background: linear-gradient(115deg, rgba(255,255,255,.22), rgba(255,255,255,0) 45%);
      opacity:.18;
      transform: translateX(-35%) skewX(-10deg);
      pointer-events:none;
      animation: sweep 6.5s ease-in-out infinite;
      border-radius: 18px;
      mix-blend-mode: screen;
    }
    .logoWrap img{
      width:58px;height:58px;object-fit:contain;
      display:block;
      filter: drop-shadow(0 16px 30px rgba(0,0,0,.25));
      animation: logoFloat 5.4s ease-in-out infinite;
    }

    .brandText{display:flex;flex-direction:column;line-height:1.05}
    .brandText .name{font-weight:1000;letter-spacing:1.4px;font-size:18px}
    .brandText .line{color:var(--muted2);font-size:12.5px;margin-top:4px}

    .topRight{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      border:1px solid var(--border);
      background: var(--chip);
      color: var(--muted);
      font-size:13px;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--warn)}
    .toggle{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--border);
      background: var(--btnGhostBg);
      cursor:pointer;
      color: var(--text);
      font-weight:900;
      user-select:none;
    }

    /* Buttons */
    .btn{
      appearance:none;border:0;cursor:pointer;
      padding:12px 14px;border-radius:
var(--radius-md);
      font-weight:1000;
      letter-spacing:.1px;
      text-decoration:none;
      display:inline-flex;align-items:center;justify-content:center;
      gap:10px;
    }
    .btn.primary{
      background: var(--grad1);
      color: var(--btnText);
      box-shadow: 0 18px 45px rgba(0,0,0,.20);
    }
    .btn.ghost{
      background: var(--btnGhostBg);
      border:1px solid var(--btnGhostBorder);
      color: var(--text);
    }

    /* Hero layout */
    .hero{
      margin-top:18px;
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:16px;
      align-items:stretch;
    }
    @media (max-width: 920px){ .hero{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--border);
      border-radius: var(--radius-xl);
      background: var(--card);
      box-shadow: var(--shadow);
      padding:26px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;inset:-2px;
      background: var(--grad2);
      opacity:.85;
      pointer-events:none;
    }

    .headline{
      margin:0;
      font-size:46px;
      line-height:1.05;
      letter-spacing:-.3px;
      animation: riseIn 950ms cubic-bezier(.16,1,.3,1) 140ms both;
      position:relative;
    }
    @media (max-width: 480px){ .headline{font-size:38px} }

    /* Keep the main sentence SMALL (not blog feel) */
    .microHeadline{
      margin:14px 0 0;
      font-size:18px;
      color: var(--muted);
      line-height:1.7;
      position:relative;
      animation: riseIn 950ms cubic-bezier(.16,1,.3,1) 220ms both;
    }
    .microHeadline strong{color:var(--text)}
    .mini{
      margin-top:10px;
      color: var(--muted2);
      font-size:13px;
      line-height:1.6;
      position:relative;
      animation: riseIn 950ms cubic-bezier(.16,1,.3,1) 300ms both;
    }

    .chips{margin-top:16px;display:flex;flex-wrap:wrap;gap:10px;position:relative}
    .chip{
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--border);
      background: var(--chip);
      color: var(--muted);
      font-size:13px;
    }

    .grid3{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
      position:relative;
    }
    @media (max-width: 920px){ .grid3{grid-template-columns:1fr} }
    .tile{
      padding:18px;border-radius: var(--radius-lg);
      border:1px solid var(--border);
      background: rgba(0,0,0,.04);
    }
    :root[data-theme="dark"] .tile{background: rgba(255,255,255,.05)}
    .tile h4{margin:0 0 8px;font-size:16px}
    .tile p{margin:0;color: var(--muted);line-height:1.65}

    .section2{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 920px){ .section2{grid-template-columns:1fr} }

    .levels{display:grid;gap:10px;margin-top:10px}
    .level{
      padding:12px 12px;
      border-radius: var(--radius-lg);
      border:1px solid var(--border);
      background: rgba(0,0,0,.03);
    }
    :root[data-theme="dark"] .level{background: rgba(0,0,0,.18)}
    .level strong{display:block;margin-bottom:4px}
    .level div{color:var(--muted);line-height:1.6}

    /* Partnership card */
    .partnerBox{
      margin-top:12px;
      padding:14px;
      border-radius: var(--radius-lg);
      border:1px solid var(--border);
      background: rgba(0,0,0,.03);
      position:relative;
    }
    :root[data-theme="dark"] .partnerBox{background: rgba(0,0,0,.18)}
    .partnerBox p{margin:0;color:var(--muted);line-height:1.6}
    .partnerBox a{font-weight:900}

    footer{
      margin-top:20px;
      padding:18px 6px;
      display:flex;flex-wrap:wrap;gap:12px;
      justify-content:space-between;align-items:center;
      color: var(--muted2);
    }
    .footA{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--border);
      background: var(--chip);
      color: var(--text);
      font-weight:1000;
    }
    .footA:hover{text-decoration:none;filter:brightness(1.03)}
    .footA .miniIcon{
      width:22px;height:22px;border-radius:8px;background: var(--grad1);
      display:grid;place-items:center;color:var(--btnText);font-weight:1000;
    }

    /* Modal */
    .modalOverlay{
      position:fixed;inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:100;
    }
    .modalOverlay.show{display:flex}

    .modal{
      width:min(520px, 100%);
      border-radius: var(--radius-xl);
      border:1px solid var(--border);
      background: var(--card);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .modal::before{
      content:"";
      position:absolute;inset:-2px;
      background: var(--grad2);
      opacity:.85;
      pointer-events:none;
    }
    .modalInner{padding:18px;position:relative}
    .modalTop{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:10px;
    }
    .modalTop h3{margin:0;font-size:16px;letter-spacing:.2px}
    .xBtn{
      border:1px solid var(--border);
      background: var(--btnGhostBg);
      color: var(--text);
      border-radius: 999px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
    }

    .tabs{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;position:relative}
    .tab{
      padding:9px 12px;border-radius:999px;
      border:1px solid var(--border);
      background: var(--btnGhostBg);
      color: var(--muted);
      font-size:12.5px;font-weight:900;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      color: var(--text);
      border-color: rgba(120,190,255,.35);
      background: linear-gradient(180deg, rgba(88,170,255,.18), rgba(139,92,246,.10));
    }

    .form{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;position:relative}
    input{
      flex:1;min-width:200px;
      padding:12px 14px;border-radius: var(--radius-md);
      border:1px solid var(--border);
      background: var(--inputBg);
      color: var(--text);
      outline:none;
    }
    input::placeholder{color: var(--muted2)}
    .status{
      margin-top:10px;
      font-size:13px;
      color: var(--muted2);
      position:relative;
    }
    .status.ok{color: var(--ok)}
    .status.bad{color: var(--bad)}
    .status.warn{color: var(--warn)}

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px;position:relative}
    .linkBtn{
      border:0;background:transparent;color:var(--link);cursor:pointer;
      font-weight:900;padding:0;
    }

    /* Mini dashboard inside modal after login */
    .dash{
      margin-top:12px;
      border-top:1px solid var(--border);
      padding-top:12px;
      display:none;
      position:relative;
    }
    .dash.show{display:block}
    .dashHead{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
    .dashHead .who{color:var(--muted);font-size:13px}
    .dashForm{margin-top:10px;display:grid;gap:10px}
    .dashForm input{min-width:unset;width:100%}

    /* Animations */
    @keyframes popIn{
      from{opacity:0;transform: scale(.92) translateY(8px)}
      to{opacity:1;transform: scale(1)
translateY(0)}
    }
    @keyframes riseIn{
      from{opacity:0;transform: translateY(14px)}
      to{opacity:1;transform: translateY(0)}
    }
    @keyframes logoFloat{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-5px)}
    }
    @keyframes floatGlow{
      0%,100%{transform: translateY(0);opacity:.88}
      50%{transform: translateY(-7px);opacity:1}
    }
    @keyframes sweep{
      0%{transform: translateX(-40%) skewX(-10deg); opacity:.08}
      35%{opacity:.18}
      60%{opacity:.12}
      100%{transform: translateX(40%) skewX(-10deg); opacity:.08}
    }

    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important}
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- Topbar -->
    <div class="topbar">
      <div class="brand">
        <div class="logoWrap">
          <img src="logo.png" alt="Pepsval logo" />
        </div>
        <div class="brandText">
          <div class="name">PEPSVAL</div>
          <div class="line">Where Shipping Trust Exists.</div>
        </div>
      </div>

      <div class="topRight">
        <div class="pill"><span class="dot"></span> Launching soon ‚Ä¢ Early access open</div>
        <button class="toggle" id="themeToggle" type="button">üåô / ‚òÄÔ∏è</button>
        <button class="btn primary" id="openLogin">Login</button>
      </div>
    </div>

    <!-- Hero -->
    <div class="hero">
      <div class="card">
        <h1 class="headline">A friendly trust layer for global shipping.</h1>

        <p class="microHeadline">
          <strong>A seafarers‚Äô e-Passport</strong> that brings <strong>verified identity</strong>,
          <strong>verified sea time</strong> and <strong>professional reputation</strong> into <strong>one profile</strong>.
        </p>

        <div class="mini">
          Built to be welcoming and clear ‚Äî profiles are private by default and you decide what to share and when.
        </div>

        <div class="chips">
          <span class="chip">Verified Identity</span>
          <span class="chip">Verified Sea Time</span>
          <span class="chip">Employer Appraisal</span>
          <span class="chip">Connections & Posts</span>
          <span class="chip">Photos & Videos</span>
          <span class="chip">Sea & Shore Jobs</span>
        </div>

        <div class="grid3">
          <div class="tile">
            <h4>For Seafarers</h4>
            <p>Build a trusted profile, store documents, track sea time, and grow your professional network.</p>
          </div>
          <div class="tile">
            <h4>For Companies</h4>
            <p>Request confirmations and appraisals respectfully, and shortlist faster with clearer signals.</p>
          </div>
          <div class="tile">
            <h4>For the Industry</h4>
            <p>A single place for trust, connections, and opportunities ‚Äî built for sea and shore careers.</p>
          </div>
        </div>
      </div>

      <div class="card" id="how">
        <div class="mini" style="margin-top:0">
          <strong>How it works (practical)</strong>
        </div>

        <ol style="margin:10px 0 0;padding-left:18px;color:var(--muted);line-height:1.75;position:relative;">
          <li><strong>Create your profile</strong> (your ‚ÄúSeafarer Passport‚Äù).</li>
          <li><strong>Add documents</strong> (CoC, passport, medical, visas, etc.).</li>
          <li><strong>Log sea time</strong> by contract (vessel, rank, dates).</li>
          <li><strong>Request confirmations</strong> when you choose.</li>
          <li>Earn clear labels ‚Äî never confusing claims.</li>
        </ol>

        <div class="mini" style="margin-top:12px">
          <strong>Verification labels (v1)</strong>
        </div>

        <div class="levels">
          <div class="level">
            <strong>Self-declared</strong>
            <div>Information added by the seafarer ‚Äî visible with clear labeling.</div>
          </div>
          <div class="level">
            <strong>Document Verified</strong>
            <div>Admin/partner checks document validity signals + expiry (format + consistency).</div>
          </div>
          <div class="level">
            <strong>Employment Confirmed</strong>
            <div>Employer confirms key details with a simple Yes/No flow (dates / vessel / rank).</div>
          </div>
          <div class="level">
            <strong>Peer Confirmed</strong>
            <div>A senior officer confirms ‚Äúserved together‚Äù ‚Äî optional, but powerful.</div>
          </div>
        </div>

        <div class="partnerBox">
          <p><strong>Partnerships / companies</strong></p>
          <p style="margin-top:6px;">
            For collaborations and partnerships:
            <a href="mailto:jithinilip@gmail.com">jithinilip@gmail.com</a>
          </p>
        </div>
      </div>
    </div>

    <footer>
      <div>¬© <span id="year"></span> Pepsval. All rights reserved.</div>

      <a class="footA"
         href="https://www.linkedin.com/in/jithinilip?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app"
         target="_blank" rel="noopener">
        <span class="miniIcon">in</span>
        Founder ‚Äî <span style="letter-spacing:.2px;">JITHIN PHILIP</span>
      </a>
    </footer>

  </div>

  <!-- LOGIN MODAL -->
  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Pepsval login">
      <div class="modalInner">
        <div class="modalTop">
          <h3>Login to Pepsval</h3>
          <button class="xBtn" id="closeModal" type="button">‚úï</button>
        </div>

        <div class="tabs">
          <div class="tab active" id="tabLogin">Login</div>
          <div class="tab" id="tabSignup">Create account</div>
        </div>

        <div class="status" id="authStatus">Email + password. Your profile stays private by default.</div>

        <form class="form" id="authForm">
          <input type="email" id="email" name="email" placeholder="Email" required />
          <input type="password" id="password" name="password" placeholder="Password" required />
          <button class="btn primary" id="authSubmit" type="submit">Login</button>
        </form>

        <div class="row">
          <button class="linkBtn" type="button" id="forgotPw">Forgot password?</button>
          <span style="color:var(--muted2);font-size:12.5px;">‚Ä¢</span>
          <button class="linkBtn" type="button" id="switchMode">Create an account</button>
        </div>

        <!-- Logged-in mini dashboard -->
        <div class="dash" id="dash">
          <div class="dashHead">
            <div>
              <div style="font-weight:1000;">Signed in</div>
              <div class="who" id="who"></div>
            </div>
            <button class="btn ghost" id="logoutBtn" type="button">Logout</button>
          </div>

          <div class="status" id="profileStatus" style="margin-top:10px;">Complete your basic profile (start).</div>

          <form class="dashForm" id="profileForm">
            <input id="full_name" placeholder="Full name" />
            <input id="nationality" placeholder="Nationality" />
            <input id="rank" placeholder="Rank" />
            <input id="dob" type="date" />
            <button class="btn primary" type="submit">Save profile</button>
          </form>
        </div>

      </div>
    </div>
  </div>

  <script>
    // =========================
    // Supabase config (yours)
    // =========================
    const SUPABASE_URL = "https://czlmeehcxrslgfvqjfsb.supabase.co";
    const SUPABASE_KEY = "sb_publishable_GgqSqLPMHV7YK0F2ck07sg_2jLMPzeV";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Theme (auto -> system, with toggle override)
    const root = document.documentElement;
    const themeBtn = document.getElementById("themeToggle");

    function systemPrefersDark(){
      return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
    }
    function applyTheme(theme){
      root.setAttribute("data-theme", theme);
      localStorage.setItem("pepsval_theme", theme);
      themeBtn.textContent = (theme === "dark") ? "‚òÄÔ∏è Light" : "üåô Dark";
    }
    const savedTheme = localStorage.getItem("pepsval_theme");
    if(savedTheme === "light" || savedTheme === "dark"){
      applyTheme(savedTheme);
    }else{
      applyTheme(systemPrefersDark() ? "dark" : "light");
    }
    themeBtn.addEventListener("click", () => {
      const cur = root.getAttribute("data-theme");
      applyTheme(cur === "dark" ? "light" : "dark");
    });

    // Modal
    const overlay = document.getElementById("modalOverlay");
    const openLogin = document.getElementById("openLogin");
    const closeModal = document.getElementById("closeModal");

    function openModal(){
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden", "false");
      setTimeout(() => document.getElementById("email").focus(), 80);
    }
    function hideModal(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden", "true");
    }

    openLogin.addEventListener("click", openModal);
    closeModal.addEventListener("click", hideModal);
    overlay.addEventListener("click", (e) => { if(e.target === overlay) hideModal(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape") hideModal(); });

    // Auth UI
    const tabLogin = document.getElementById("tabLogin");
    const tabSignup = document.getElementById("tabSignup");
    const switchMode = document.getElementById("switchMode");
    const authStatus = document.getElementById("authStatus");
    const authSubmit = document.getElementById("authSubmit");
    const authForm = document.getElementById("authForm");
    const forgotPw = document.getElementById("forgotPw");

    const dash = document.getElementById("dash");
    const who = document.getElementById("who");
    const logoutBtn = document.getElementById("logoutBtn");

    const profileForm = document.getElementById("profileForm");
    const profileStatus = document.getElementById("profileStatus");

    let mode = "login"; // or "signup"

    function setStatus(el, text, cls){
      el.className = "status " + (cls || "");
      el.textContent = text;
    }

    function setMode(next){
      mode = next;
      if(mode === "login"){
        tabLogin.classList.add("active");
        tabSignup.classList.remove("active");
        authSubmit.textContent = "Login";
        switchMode.textContent = "Create an account";
        setStatus(authStatus, "Email + password. Your profile stays private by default.", "");
      }else{
        tabSignup.classList.add("active");
        tabLogin.classList.remove("active");
        authSubmit.textContent = "Create account";
        switchMode.textContent = "I already have an account";
        setStatus(authStatus, "Create your account. If email confirmation is enabled, check your inbox to confirm.", "");
      }
    }

    tabLogin.addEventListener("click", () => setMode("login"));
    tabSignup.addEventListener("click", () => setMode("signup"));
    switchMode.addEventListener("click", () => setMode(mode === "login" ? "signup" : "login"));

    // Auth submit
    authForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      try{
        if(mode === "login"){
          const { error } = await sb.auth.signInWithPassword({ email, password });
          if(error) throw error;
          setStatus(authStatus, "‚úÖ Logged in successfully.", "ok");
          await renderSession();
        }else{
          const { error } = await sb.auth.signUp({ email, password });
          if(error) throw error;
          setStatus(authStatus, "‚úÖ Account created. If required, confirm your email and then login.", "ok");
          setMode("login");
        }
      }catch(err){
        setStatus(authStatus, "‚ö†Ô∏è " + (err.message || "Something went wrong."), "bad");
      }
    });

    // Password reset
    forgotPw.addEventListener("click", async () => {
      const email = document.getElementById("email").value.trim();
      if(!email){
        setStatus(authStatus, "Enter your email first, then tap ‚ÄúForgot password?‚Äù.", "warn");
        return;
      }
      try{
        const { error } = await sb.auth.resetPasswordForEmail(email);
        if(error) throw error;
        setStatus(authStatus, "‚úÖ Password reset email sent (if that email exists).", "ok");
      }catch(err){
        setStatus(authStatus, "‚ö†Ô∏è " + (err.message || "Could not send reset email."), "bad");
      }
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      await sb.auth.signOut();
      dash.classList.remove("show");
      setMode("login");
      setStatus(authStatus, "Logged out.", "ok");
    });

    // Load profile
    async function loadProfile(){
      const { data: { user } } = await sb.auth.getUser();
      if(!user) return;

      const { data, error } = await sb
        .from("profiles")
        .select("full_name, nationality, rank, dob")
        .eq("id", user.id)
        .maybeSingle();

      if(error){
        setStatus(profileStatus, "‚ö†Ô∏è Could not load profile: " + error.message, "bad");
        return;
      }

      document.getElementById("full_name").value = data?.full_name || "";
      document.getElementById("nationality").value = data?.nationality || "";
      document.getElementById("rank").value = data?.rank || "";
      document.getElementById("dob").value = data?.dob || "";
      setStatus(profileStatus, "Complete your basic profile (start).", "");
    }

    // Save profile
    profileForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const { data: { user } } = await sb.auth.getUser();
      if(!user){
        setStatus(profileStatus, "You are not logged in.", "bad");
        return;
      }

      const payload = {
        id: user.id,
        full_name:
document.getElementById("full_name").value.trim() || null,
        nationality: document.getElementById("nationality").value.trim() || null,
        rank: document.getElementById("rank").value.trim() || null,
        dob: document.getElementById("dob").value || null,
        updated_at: new Date().toISOString(),
      };

      const { error } = await sb.from("profiles").upsert(payload, { onConflict: "id" });

      if(error){
        setStatus(profileStatus, "‚ö†Ô∏è Save failed: " + error.message, "bad");
        return;
      }
      setStatus(profileStatus, "‚úÖ Profile saved.", "ok");
    });

    // Session render
    async function renderSession(){
      const { data: { session } } = await sb.auth.getSession();
      if(session?.user){
        dash.classList.add("show");
        who.textContent = session.user.email || "Signed in";
        await loadProfile();
      }else{
        dash.classList.remove("show");
      }
    }

    // Keep in sync
    sb.auth.onAuthStateChange(async () => {
      await renderSession();
    });

    // Initial render
    renderSession();
    setMode("login");
  </script>
</body>
</html>